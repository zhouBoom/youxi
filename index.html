<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <meta name="keywords" content=""/>
    <meta name="description" content=""/>
    <link rel="stylesheet" href="css/amazeui.min.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/pullToRefresh.css"/>
    <link rel="stylesheet" href="css/loading.css">
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script>
        //        function resize(){
        //            $('html').css('font-size',($(window).width())/4.14+'px');
        //        };
        //        window.onresize=resize;
        //
        //        $(function(){resize();});
    </script>
    <title>看点真的</title>
</head>
<style>

</style>
<body>
<div class="inner">
    <div class="load-container load_dh">
        <div class="spinner">
            <div class="rect1"></div>
            <div class="rect2"></div>
            <div class="rect3"></div>
            <div class="rect4"></div>
            <div class="rect5"></div>
            <span>正在搜索</span>
        </div>
    </div>
</div>
<header>
    <div class="search">
        <form action="" onsubmit="return checksearch()" id="searchForm" name="searchForm">
            <div class="ui-searchbar-wrap ui-border-b">
                <div class="ui-searchbar ui-border-radius">
                    <div class="ui-searchbar-neirong">
                        <img src="image/search.png">
                        <span class="ui-searchbar-text">咨讯</span>
                    </div>
                    <div class="ui-searchbar-input">
                        <img src="image/search.png" class="ui-input-img">
                        <input onpropertychange="handle();" oninput="handle();" tabindex="1" name="word" id="search-kw"
                               value="" type="text" placeholder="咨讯" autocapitalize="off">
                    </div>
                    <i class="ui-icon-close"></i>
                </div>
                <button type="submit" id="search_btn" class="ui-searchbar-cancel">取消</button>
            </div>
        </form>
    </div>
</header>
<section class="sec-result">
    <div class="ui-tab" id="tab1">
        <ul class="ui-tab-nav ui-border-b">
            <li>
                <span class="test_ajax" data-type="1" >推荐</span>
            </li>
            <li>
                <span data-type="2">视频</span>
            </li>
            <li>
                <span data-type="3">干货</span>
            </li>
            <li>
                <span data-type="4">逗逼</span>
            </li>
            <img src="image/drop-down.png">
        </ul>
        <!--list列表-->
        <div class="list-container" id="wrapper">
            <ul>
                <!--<li class="ui-list">-->
                <!--<img src="image/guanbi.png" class="guanbi">-->
                <!--<div class="am-g ui-list-title">-->
                <!--<img src="img/a1.png" class="am-u-sm-4">-->
                <!--<div class="am-u-sm-8">-->
                <!--<h5>热烈庆祝小程序上线</h5>-->
                <!--<div class="pet_hd_con_gp_list">-->
                <!--<span class="pet_hd_con_gp_list_on">VIP</span>-->
                <!--<span class="pet_hd_con_gp_list_on">小程序</span>-->
                <!--</div>-->
                <!--</div>-->
                <!--</div>-->
                <!--<hr data-am-widget="divider" style="" class="am-divider am-divider-default user-divider"/>-->
                <!--<div class="am-g ui-list-author">-->
                <!--<div class="am-u-sm-4 clean">-->
                <!--<img src="img/a1.png">-->
                <!--<span>信息咨讯</span>-->
                <!--</div>-->
                <!--<div class="am-u-sm-8">-->
                <!--<span>刚刚</span>-->
                <!--<div class="zan">-->
                <!--<img src="image/zan-g.png">-->
                <!--<span>18</span>-->
                <!--</div>-->
                <!--</div>-->
                <!--</div>-->
                <!--</li>-->
            </ul>
        </div>
    </div>
</section>
<!-- 主题选择（theme) -->
<div class="theme-choice">
    <div class="theme-now">
        <span class="yixuan">已选主题</span><span class="tuozhuai">拖拽可以排序</span>
        <img src="image/drop-down.png" class="drop-up">
        <div class="theme">
            <span>推荐 <img src="image/guanbi-yuan.png"></span>
            <span>视频 <img src="image/guanbi-yuan.png"></span>
            <span>真知灼见 <img src="image/guanbi-yuan.png"></span>
            <span>名真言顺 <img src="image/guanbi-yuan.png"></span>
            <span>推荐 <img src="image/guanbi-yuan.png"></span>
            <span>视频 <img src="image/guanbi-yuan.png"></span>
            <span>真知灼见 <img src="image/guanbi-yuan.png"></span>
            <span>名真言顺 <img src="image/guanbi-yuan.png"></span>
        </div>
    </div>
    <div class="theme-future">
        <span class="yixuan">添加主题</span>
        <div class="theme-add">
            <span>推荐</span>
            <span>视频</span>
            <span>真知灼见</span>
            <span>名真言顺</span>
            <span>推荐</span>
            <span>视频</span>
            <span>真知灼见</span>
            <span>名真言顺</span>
        </div>
    </div>
</div>

<footer class="ui-footer ui-footer-btn">
    <ul class="ui-tiled active">
        <li>
            <a href="index.html">
                <img src="image/home-b.png">
                <div>
                    <span class="test_ajax">首页</span>
                </div>
            </a>
        </li>
        <li>
            <a href="follow.html">
                <img src="image/guanzhu-g.png">
                <div>
                    <span>关注</span>
                </div>
            </a>
        </li>
        <li>
            <a href="person.html">
                <img src="image/wode-g.png">
                <div>
                    <span>我的</span>
                </div>
            </a>
        </li>
    </ul>

</footer>
<script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="js/iscroll.js"></script>
<script src="js/pullToRefresh.js"></script>
<script src="js/app.js" type="text/javascript"></script>
<!--<script src="js/amazeui.min.js" type="text/javascript"></script>-->
<script src="js/amazeui.lazyload.min.js" type="text/javascript"></script>
<script type="text/javascript">


    $(function () {
        //动态设置刷新的高度
        $('#wrapper').css('height', window.screen.height - 180 + 'px');
        //li点击
        $('.ui-tab-nav li span').on('click',function () {
            $('.ui-tab-nav .test_ajax').removeClass('test_ajax');
            $(this).addClass("test_ajax");
            Refresh();
        });


    });

    function wx_login() {

    }

    refresher.init({

        id: "wrapper",

        pullDownAction: Refresh,

        pullUpAction: Load

    });

    function Refresh() {
        var type = $('.test_ajax').data('type');
        console.log(type);
        alert_show();
        setTimeout(function () {
            var el, li, i, zanimg;
            el = $("#wrapper ul");
            num = 1;
            el.html('')
            var data = JSON.stringify({"userid": "4e2ecf90-61b7-4314-8992-c34f2e541b7b","type":type,"pages":num});
            $.ajax({
                url: 'http://fxg.ruizsky.com:8080/youxi/v1/contents',
                type: "POST",
                data: data,
//                async: false,       //关键是这句
                dataType: 'json',
                contentType: "application/json",
                success: function (data) {
                    if (data.status == 200) {
                        if(data.conts.length==0){
                            new Toast({
                                context: $('body'),
                                message: '暂无数据'
                            }).show();
                        }
                        for (i = 0; i < data.conts.length; i++) {
                            var lable = '';
                            $.each(data.conts[i].labels,function (k, v) {
                                lable = lable + "<span class='pet_hd_con_gp_list_on'>" + v.desp + "</span>";
                            })
                            if(data.conts[i].makeThumbup == 1){
                                zanimg = "image/zan-b.png";
                            }else{
                                zanimg = "image/zan-g.png";
                            }
                            li = "<li class='ui-list'>"
                                + "<img src='image/guanbi.png' class='guanbi' data-id ='" + data.conts[i].id + "'>"
                                + " <div class='am-g ui-list-title'>"
                                + " <img src='" + data.conts[i].icon + "' class='am-u-sm-4'>"
                                + " <div class='am-u-sm-8'>"
                                + " <a data-url='" + data.conts[i].url + "' data-id = '" + data.conts[i].id + "'>" + data.conts[i].title + "</a>"
                                + " <div class='pet_hd_con_gp_list'>"
                                + lable
                                + " </div>"
                                + " </div>"
                                + " </div>"
                                + " <hr data-am-widget='divider' style='' class='am-divider am-divider-default user-divider'/>"
                                + " <div class='am-g ui-list-author'>"
                                + " <div class='am-u-sm-4 clean'>"
                                + " <img src='img/a1.png'>"
                                + " <span>" + data.conts[i].officialaccount + "</span>"
                                + " </div>"
                                + " <div class='am-u-sm-8'>"
                                + " <span>" + data.conts[i].updatetime + "</span>"
                                + " <div class='zan'>"
                                + " <img src='"+zanimg+"' data-id='" + data.conts[i].id + "'>"
                                + " <span>" + data.conts[i].qtyofthumbup + "</span>"
                                + " </div>"
                                + " </div>"
                                + " </div>"
                                + " </li>";
                            el.append(li);
                        }
                        alert_hid();
                    } else {
                        new Toast({
                            context: $('body'),
                            message: '暂无更多数据'
                        }).show();
                    }
                },
                error: function () {
                    alert('error');
                }
            });

            myScroll.refresh();
        }, 1000);
    }

    function Load() {
        var type = $('.test_ajax').data('type');
        console.log(type);
        alert_show();
        setTimeout(function () {
            var el, li, i;
            el = $("#wrapper ul");
            num++;
            var data = JSON.stringify({"userid": "4e2ecf90-61b7-4314-8992-c34f2e541b7b","type":type,"pages":num});
            console.log(data);
            $.ajax({
                url: 'http://fxg.ruizsky.com:8080/youxi/v1/contents',
                type: "POST",
                data: data,
                async: false,       //关键是这句
                dataType: 'json',
                contentType: "application/json",
                success: function (data) {
                    if (data.status == 200) {

                        if(data.conts.length==0){
                            new Toast({
                                context: $('body'),
                                message: '暂无更多数据'
                            }).show();
                        }
                        for (i = 0; i < data.conts.length; i++) {
                            var lable = '';
                            $.each(data.conts[i].labels,function (k, v) {
                                lable = lable + "<span class='pet_hd_con_gp_list_on'>" + v.desp + "</span>";
                            })
                            if(data.conts[i].makeThumbup == 1){
                                zanimg = "image/zan-b.png";
                            }else{
                                zanimg = "image/zan-g.png";
                            }
                            li = "<li class='ui-list'>"
                                + "<img src='image/guanbi.png' class='guanbi' data-id ='" + data.conts[i].id + "'>"
                                + " <div class='am-g ui-list-title'>"
                                + " <img src='" + data.conts[i].icon + "' class='am-u-sm-4'>"
                                + " <div class='am-u-sm-8'>"
                                + " <a data-url='" + data.conts[i].url + "' data-id = '" + data.conts[i].id + "'>" + data.conts[i].title + "</a>"
                                + " <div class='pet_hd_con_gp_list'>"
                                + lable
                                + " </div>"
                                + " </div>"
                                + " </div>"
                                + " <hr data-am-widget='divider' style='' class='am-divider am-divider-default user-divider'/>"
                                + " <div class='am-g ui-list-author'>"
                                + " <div class='am-u-sm-4 clean'>"
                                + " <img src='img/a1.png'>"
                                + " <span>" + data.conts[i].officialaccount + "</span>"
                                + " </div>"
                                + " <div class='am-u-sm-8'>"
                                + " <span>" + data.conts[i].updatetime + "</span>"
                                + " <div class='zan'>"
                                + " <img src='"+zanimg+"' data-id='" + data.conts[i].id + "'>"
                                + " <span>" + data.conts[i].qtyofthumbup + "</span>"
                                + " </div>"
                                + " </div>"
                                + " </div>"
                                + " </li>";
                            el.append(li);
                        }
                        alert_hid();
                    } else {
                        new Toast({
                            context: $('body'),
                            message: '暂无更多数据'
                        }).show();
                    }
                },
                error: function () {
                    alert('error');
                }
            });
            myScroll.refresh();
        }, 1000);

    }

    //调用系统删除接口
    $(document).on('click','.guanbi',function () {
        //ajax请求删除方法
        $(this).parents('.ui-list').fadeTo("slow", 0.01, function(){//fade
            var id = $(this).children('.guanbi').data('id');
            var data = JSON.stringify({"userid": "12345678"});
            $(this).remove();
            $.ajax({
                url: 'http://fxg.ruizsky.com:8080/youxi/v1/contents/'+id,
                type: "DELETE",
                data: data,
                async: false,       //关键是这句
                dataType: 'json',
                contentType: "application/json",
                success: function (data) {
                    console.log(data);
                    if(data.status == 200){
                        new Toast({
                            context: $('body'),
                            message: '删除成功'
                        }).show();
                    }else{
                        new Toast({
                            context: $('body'),
                            message: '删除失败'
                        }).show();
                    }
                },
                error:function () {
                    new Toast({
                        context: $('body'),
                        message: '删除失败,接口错误'
                    }).show();
                }
            });
            if($('.ui-list').length == 0){
                new Toast({
                    context : $('body'),
                    message : '不能全部删除'
                }).show();
                Refresh();
            }
        });
    });
</script>

</body>
</html>